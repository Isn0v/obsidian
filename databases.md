
# Реляционные (SQL) базы данных

## Что такое индексы

Это структура данных, созданная для того, чтобы снижать время поиска каких-то запрошенных данных. Достигается это за счет хранения какой-то дополнительной информации 

### Как индексы работают

**Основная задача** - нужно получить нужную колонку данных, не сканируя весь диск, потому что это долго

**Решение** - создать хэш таблицу, которая содержит в себе определенную инфу, с помощью которой можно сразу добраться до нужной колонки. Это называется **Index leaf nodes**. Она ставит каждому индексу в соответствие место, где в памяти находится нужная колонка.

Сканировать индексы проще, чем данные в постоянной памяти. Для эффективного добавления и удаления индексов обычно используется двусвязный список (об этом дальше)

## Балансирующие деревья

Так как индексы физически не находятся в отсортированном порядке,  порядок также надо поддерживать с достаточно приемлемой эффективностью.

На помощь идут сбалансированные деревья (BTree, B+Tree), где балансировка идет по индексам.

Различие между ними в том, что в B+Tree только в конечных узлах имеются структуры данных с индексами, которые указывают на нужные колонки данных в постоянной памяти. В промежуточных узлах не содержится никаких указателей. 

> Двусвязный список как раз используется внутри конечных узлов сбалансированного дерева для быстрого перебора индексов

![[Pasted image 20250818105414.png]]


## Что такое транзакция

Это единица измерения работы, которая должна расцениваться как единая, то эта работа должна быть выполнена полностью либо не быть выполнена вообще. Больше всего нас интересует аспект **Изоляции** касаемо транзакций.

### Свойства транзакций

Различается 4 свойства (ACID), которые должна поддерживать любая база данных

- **Atomicity (Атомарность)** - изменения внутри базы данных не должно происходить частично относительно какой-то транзакции
- **Consistency (Согласованность)** - гарантия, что транзакция переводит базу данных из одного корректного состояния в другое. В терминах модели согласованности это строгая модель согласованности (strict consistency)
- **Isolation (Изоляция)** - определяется, какие изменения должны быть видны остальным пользователем в многопоточной среде  при изменения состояние базы данных каким-то пользователем. Обычно это подразумевает просто  использование взаимного исключения на какой-то аспект выполнения транзакции или сущности внутри транзакции
- **Durability (Долговечность)** - гарантия, что изменения, совершенные транзакцией, навсегда сохранятся

### Уровни изоляции

- **Repeatable read** - консистентное чтение данных **ТОЛЬКО** во время выполнения транзакции, то есть взаимное исключение на транзакцию 
- **Serializable** - консистентное чтение данных во время выполнения запроса (query)
- **Read Committed** - создание снапшота (консистентного набора данных) во время запроса на чтение, обычно без использования взаимных исключений
- **Read Uncommitted** - вообще никаких взаимных исключений

# Нереляционные NoSQL базы данных

## Особенности

- Гибкий формат хранения данных (деревья, хеш-таблицы, графы)
- Ориентированы на горизонтальное масштабирование
- Дают возможность работать с неструктурированными данными (или полуструктурированными)

## Свойства транзакций

Большинство нереляционных баз данных поддерживают **BASE** свойства:

- Basically Available - дата реплицирована на несколько хранилищ и доступна в каждом из них наибольшее количество времени
- Soft-State - состояние данных может быть некорректным тогда и только тогда, когда данные еще не полностью собрались
- Eventually consistent - не все реплики узлов в базе данных получат обновления сразу, но система гарантирует, что в конце концов их состояние синхронизируется, если не произойдет дополнительных изменений

## Теорема CAP (теорема Брюера)

В любой распределенной системе можно обеспечить максимум 2 из этих 3 свойств:

- Согласованность - все узлы в системе видят одни и те же данные 
> **Примечание:** здесь согласованность **НЕ** то же, что и в ACID свойствах. Второе говорит о согласованности данных в узлах после транзакции, первое - о общей согласованности между узлами в любое время, не важно ошибки это или нет
- Доступность - каждый запрос в системе получает ответ, даже если не все узлы работают
- Устойчивость к разделению сети - система продолжает работать корректно, несмотря на разделение сети, когда разделенные узлы не могут общаться друг с другом

# SQL vs NoSQL базы данных

1. Структура базы данных
	- 
2. Производительность
3. 